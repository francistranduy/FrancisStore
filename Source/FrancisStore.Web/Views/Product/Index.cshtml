@model FrancisStore.Web.Models.PagedProductListViewModel
@{
    ViewBag.Title = "Product";
    Layout = "~/Views/Shared/_ContentLayout.cshtml";
}

<div class="row">
    <div class="col-sm-6 col-md-4 col-lg-3 p-b-50">
        <div class="leftbar p-r-20 p-r-0-sm">
            <!-- Categories -->
            @{Html.RenderPartial("_Categories", Model.Collections);}

            <!-- Filters -->
            @{Html.RenderPartial("_Filters");}
        </div>
    </div>

    <div class="col-sm-6 col-md-8 col-lg-9 p-b-50">
        <!-- Sorting -->
        @{Html.RenderPartial("_Sorting", Model.PagedList);}

        <!-- Product -->
        <div class="row">
            @foreach (var product in Model.Products)
            {
                <div class="col-sm-12 col-md-6 col-lg-4 p-b-50">
                    <!-- Block2 -->
                    <div class="block2">
                        <div class="block2-img wrap-pic-w of-hidden pos-relative block2-labelnew">
                            <img src="@product.Image" alt="IMG-PRODUCT">

                            <div class="block2-overlay trans-0-4">
                                <a href="#" class="block2-btn-addwishlist hov-pointer trans-0-4">
                                    <i class="icon-wishlist icon_heart_alt" aria-hidden="true"></i>
                                    <i class="icon-wishlist icon_heart dis-none" aria-hidden="true"></i>
                                </a>

                                <div class="block2-btn-addcart w-size1 trans-0-4">

                                    @using (Html.BeginForm("AddToCart", "Cart", FormMethod.Post, new { @class = "form-horizontal form-addcart", role = "form" }))
                                    {
                                        <input name="@nameof(product.VariantId)" type="hidden" id="@nameof(product.VariantId)" value="@product.VariantId" />
                                        <input name="Quantity" type="hidden" value="1" />
                                        <input class="flex-c-m size1 bg4 bo-rad-23 hov1 s-text1 trans-0-4 btn-addcart" type="submit" value="Add to Cart" />
                                    }
                                </div>
                            </div>
                        </div>

                        <div class="block2-txt p-t-20">
                            @Html.ActionLink(product.Name, "Details", "Product", new { Id = product.Id }, new { @class = "block2-name dis-block s-text3 p-b-5" })
                            <span class="block2-price m-text6 p-r-5">
                                $@product.Price
                            </span>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Pagination -->
        @{Html.RenderPartial("_Pagination", Model.PagedList);}
    </div>
</div>



@section TitlePage
    {
    @{Html.RenderPartial("_TitlePage");}
}

@section DropdownSelection
{
    <div id="FilterSelections"></div>
}

@section Scripts
{
    <script type="text/javascript" src="~/lib/bootstrap-daterangepicker/moment.min.js"></script>
    <script type="text/javascript" src="~/lib/bootstrap-daterangepicker/daterangepicker.min.js"></script>
    <script type="text/javascript" src="~/lib/slick-carousel/slick.min.js"></script>
    <script type="text/javascript" src="~/lib/sweetalert/sweetalert.min.js"></script>
    <script type="text/javascript" src="~/lib/noUiSlider/nouislider.min.js"></script>
    <script type="text/javascript" src="~/Scripts/slick-custom.js"></script>
    <script>
        //Filter Selections
        $(".selection-2").select2({
            minimumResultsForSearch: 20,
            dropdownParent: $('#FilterSelections')
        });

        //Add to whishlist modal
        $('.block2-btn-addwishlist').each(function () {
            var nameProduct = $(this).parent().parent().parent().find('.block2-name').html();
            $(this).on('click', function () {
                swal(nameProduct, "is added to wishlist !", "success");
            });
        });

        //Filter slider
        var filterBar = document.getElementById('filter-bar');

        noUiSlider.create(filterBar, {
            start: [50, 200],
            connect: true,
            range: {
                'min': 50,
                'max': 200
            }
        });

        var skipValues = [
            document.getElementById('value-lower'),
            document.getElementById('value-upper')
        ];

        filterBar.noUiSlider.on('update', function (values, handle) {
            skipValues[handle].innerHTML = Math.round(values[handle]);
        });

        //Add to card modal
        $(".form-addcart").submit(function AddToCart(event) {
            event.preventDefault();
            var data = $(event.target).serializeObject();
            var url = $(event.target).attr("action");
            var nameProduct = $(event.target).parent().parent().parent().parent().find('.block2-name').html();

            $.ajax({
                url: url,
                type: "POST",
                data: JSON.stringify(data),
                contentType: "application/json; charset=utf-8",
                complete: function (jqXHR, textStatus) {
                    if (jqXHR.status == 200) {
                        swal(nameProduct, "is added to cart !", "success");
                        return;
                    }

                    if (jqXHR.status == 404) {
                        swal(nameProduct, "An error occurred!", "success");
                    }

                    console.log("An error occurred!");
                }
            });
        });
    </script>
}

@section Styles
{
    <link rel="stylesheet" type="text/css" href="~/lib/noUiSlider/nouislider.min.css">
}